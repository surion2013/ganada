<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />
    <title>Sign Up - GaNaDa</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
</head>
<body>
    <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
        <!-- 로고 섹션 -->
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <div class="flex justify-center items-center mb-8">
                <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.href='index.html'">
                    <div class="size-6">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="#121416"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">GaNaDa</h1>
                </div>
            </div>
        </div>

        <!-- 회원가입 폼 섹션 -->
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-white py-8 px-6 shadow-sm rounded-lg sm:px-10">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Sign Up for GaNaDa</h2>
                </div>
                    
                    <form class="space-y-6" id="signup-form">
                    <div>
                        <input
                            id="username"
                            name="username"
                            type="text"
                            required
                            class="appearance-none relative block w-full px-4 py-4 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:z-10 text-base bg-gray-50"
                            placeholder="Username"
                        />
                        <span id="username-error" class="text-red-500 text-xs mt-1 hidden"></span>
                    </div>

                    <div>
                        <input
                            id="password"
                            name="password"
                            type="password"
                            required
                            class="appearance-none relative block w-full px-4 py-4 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:z-10 text-base bg-gray-50"
                            placeholder="Password"
                        />
                        <span id="password-error" class="text-red-500 text-xs mt-1 hidden"></span>
                    </div>

                    <div>
                        <input
                            id="confirm-password"
                            name="confirm-password"
                            type="password"
                            required
                            class="appearance-none relative block w-full px-4 py-4 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:z-10 text-base bg-gray-50"
                            placeholder="Confirm Password"
                        />
                        <span id="confirm-password-error" class="text-red-500 text-xs mt-1 hidden"></span>
                    </div>

                    <div>
                        <button
                            type="submit"
                            class="group relative w-full flex justify-center py-4 px-4 border border-transparent text-base font-medium rounded-full text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                            id="signup-btn"
                        >
                            Sign Up
                        </button>
                    </div>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-gray-600">
                        Already have an account? 
                        <a href="login.html" class="text-blue-600 hover:text-blue-500 font-medium">Log in</a>
                    </p>
                </div>
                </div>
            </div>
        </div>
        
        <!-- 푸터 -->
        <footer class="mt-auto py-3">
            <div class="flex flex-col items-center justify-center gap-1">
                <div class="flex items-center gap-2 text-[#6a7581]">
                    <div class="size-3">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">GaNaDa</span>
                </div>
                <p class="text-[#6a7581] text-xs text-center leading-tight">
                    © 2025 UJUSOL. All rights reserved.
                </p>
            </div>
        </footer>

        <!-- 성공 모달 -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 text-center">
                <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Sign Up Complete!</h3>
                <p class="text-gray-600 text-sm mb-4">Welcome to GaNaDa! You can now explore and share amazing artworks.</p>
                <button
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-white bg-blue-600 hover:bg-blue-700 font-medium"
                    onclick="closeSuccessModal()"
                >
                    Get Started
                </button>
            </div>
        </div>

        <!-- 에러 모달 -->
        <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 text-center">
                <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Sign Up Failed</h3>
                <p class="text-gray-600 text-sm mb-4" id="error-message">An error occurred during sign up. Please try again.</p>
                <button
                    class="w-full flex justify-center py-3 px-4 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 font-medium"
                    onclick="closeErrorModal()"
                >
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <script>
        // Form validation and submission
        document.getElementById('signup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Clear previous errors
            clearErrors();

            let hasErrors = false;

            // Validate username
            if (username.length < 3) {
                showError('username-error', 'Username must be at least 3 characters long.');
                hasErrors = true;
            } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showError('username-error', 'Username can only contain letters, numbers, and underscores.');
                hasErrors = true;
            }

            // Validate password
            if (password.length < 6) {
                showError('password-error', 'Password must be at least 6 characters long.');
                hasErrors = true;
            } else if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                showError('password-error', 'Password must contain both letters and numbers.');
                hasErrors = true;
            }

            // Validate password confirmation
            if (password !== confirmPassword) {
                showError('confirm-password-error', 'Passwords do not match.');
                hasErrors = true;
            }

            if (!hasErrors) {
                performSignup(username, password);
            }
        });

        async function performSignup(username, password) {
            const submitBtn = document.getElementById('signup-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Signing up...';

            try {
                // 임시 이메일 생성 (username@ganada.com)
                const email = `${username}@ganada.com`;
                
                // Supabase 회원가입
                const result = await SupabaseClient.Auth.signUp(email, password, {
                    username: username,
                    full_name: username
                });

                if (result.success) {
                    // 회원가입 성공
                    console.log('Signup successful:', result.data);
                    
                    // 사용자 프로필 생성
                    if (result.data.user) {
                        const profileResult = await SupabaseClient.Database.upsertUserProfile(result.data.user.id, {
                            email: email,
                            username: username,
                            full_name: username,
                            avatar_url: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop&crop=face',
                            bio: '',
                            followers_count: 0,
                            following_count: 0,
                            posts_count: 0
                        });

                        if (profileResult.success) {
                            console.log('Profile created:', profileResult.data);
                        }
                    }
                    
                    showSuccessModal();
                } else {
                    // 회원가입 실패
                    showErrorModal(result.error);
                }
            } catch (error) {
                console.error('Signup error:', error);
                showErrorModal('An error occurred during sign up.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Sign Up';
            }
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function clearErrors() {
            const errorElements = document.querySelectorAll('[id$="-error"]');
            errorElements.forEach(element => {
                element.classList.add('hidden');
                element.textContent = '';
            });
        }

        function showSuccessModal() {
            document.getElementById('success-modal').classList.remove('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
            window.location.href = 'index.html';
        }

        function showErrorModal(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
        }

        function closeErrorModal() {
            document.getElementById('error-modal').classList.add('hidden');
        }



        // Real-time validation
        document.getElementById('username').addEventListener('blur', function() {
            const username = this.value.trim();
            if (username && username.length < 3) {
                showError('username-error', 'Username must be at least 3 characters long.');
            } else if (username && !/^[a-zA-Z0-9_]+$/.test(username)) {
                showError('username-error', 'Username can only contain letters, numbers, and underscores.');
            } else {
                document.getElementById('username-error').classList.add('hidden');
            }
        });

        document.getElementById('password').addEventListener('blur', function() {
            const password = this.value;
            if (password && password.length < 6) {
                showError('password-error', 'Password must be at least 6 characters long.');
            } else if (password && !/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                showError('password-error', 'Password must contain both letters and numbers.');
            } else {
                document.getElementById('password-error').classList.add('hidden');
            }
        });

        document.getElementById('confirm-password').addEventListener('blur', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            if (confirmPassword && password !== confirmPassword) {
                showError('confirm-password-error', 'Passwords do not match.');
            } else {
                document.getElementById('confirm-password-error').classList.add('hidden');
            }
        });
    </script>
</body>
</html> 