<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - GaNaDa</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden" style="font-family: 'Plus Jakarta Sans', 'Noto Sans', sans-serif;">
        <div class="layout-container flex h-full grow flex-col min-h-screen">
            <!-- Header -->
            <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f1f2f4] px-10 py-3">
                <div class="flex items-center gap-2 text-[#121416]">
                    <div class="size-4">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <h2 class="text-[#121416] text-lg font-bold leading-tight tracking-[-0.015em]">
                        <a href="index.html">GaNaDa</a>
                    </h2>
                </div>
                <div class="flex flex-1 justify-end gap-8">
                    <div class="flex items-center gap-9"></div>
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 cursor-pointer" style="background-image: url('https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop&crop=face')" onclick="window.location.href='profile.html'"></div>
                </div>
            </header>

            <!-- Main Content -->
            <div class="px-40 flex flex-1 justify-center py-5">
                <div class="layout-content-container flex flex-col w-[512px] max-w-[512px] py-5 max-w-[960px] flex-1">
                    <h2 class="text-[#121416] tracking-light text-[28px] font-bold leading-tight px-4 text-center pb-3 pt-5">Sign Up for GaNaDa</h2>
                    
                    <form id="signup-form">
                        <!-- Username Field -->
                        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
                            <label class="flex flex-col min-w-40 flex-1">
                                <input id="username" type="text" placeholder="Username" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121416] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#6a7581] p-4 text-base font-normal leading-normal" required>
                                <span id="username-error" class="text-red-500 text-xs mt-1 hidden"></span>
                            </label>
                        </div>

                        <!-- Password Field -->
                        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
                            <label class="flex flex-col min-w-40 flex-1">
                                <input id="password" type="password" placeholder="Password" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121416] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#6a7581] p-4 text-base font-normal leading-normal" required>
                                <span id="password-error" class="text-red-500 text-xs mt-1 hidden"></span>
                            </label>
                        </div>

                        <!-- Confirm Password Field -->
                        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
                            <label class="flex flex-col min-w-40 flex-1">
                                <input id="confirm-password" type="password" placeholder="Confirm Password" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#121416] focus:outline-0 focus:ring-0 border-none bg-[#f1f2f4] focus:border-none h-14 placeholder:text-[#6a7581] p-4 text-base font-normal leading-normal" required>
                                <span id="confirm-password-error" class="text-red-500 text-xs mt-1 hidden"></span>
                            </label>
                        </div>



                        <!-- Submit Button -->
                        <div class="flex px-4 py-3">
                            <button id="signup-btn" type="submit" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 flex-1 bg-[#b2cae5] text-[#121416] text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#a0bdd9] transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="truncate">Sign Up</span>
                            </button>
                        </div>
                    </form>

                    <p class="text-[#6a7581] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">
                        Already have an account? 
                        <a href="login.html" class="text-[#b2cae5] hover:underline">Login</a>
                    </p>
                </div>
            </div>
        </div>
        <footer class="border-t border-solid border-t-[#f0f2f4] px-10 py-3 mt-auto">
            <div class="flex flex-col items-center justify-center gap-1">
                <div class="flex items-center gap-2 text-[#6a7581]">
                    <div class="size-3">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">GaNaDa</span>
                </div>
                <p class="text-[#6a7581] text-xs text-center leading-tight">
                    © 2025 UJUSOL. All rights reserved.
                </p>
            </div>
        </footer>

        <!-- Success Modal -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-[#121416] mb-2">Sign Up Complete!</h3>
                    <p class="text-[#6a7581] mb-6">Welcome! Now you can explore and share amazing artworks on GaNaDa.</p>
                    <button onclick="closeSuccessModal()" class="w-full bg-[#b2cae5] text-[#121416] font-bold py-3 px-4 rounded-xl hover:bg-[#a0bdd9] transition-colors">
                        Get Started
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Modal -->
        <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="text-center">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-[#121416] mb-2">Sign Up Failed</h3>
                    <p id="error-message" class="text-[#6a7581] mb-6">An error occurred during sign up. Please try again.</p>
                    <button onclick="closeErrorModal()" class="w-full bg-[#f1f2f4] text-[#121416] font-bold py-3 px-4 rounded-xl hover:bg-[#e5e7eb] transition-colors">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Form validation and submission
        document.getElementById('signup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Clear previous errors
            clearErrors();

            let hasErrors = false;

            // Validate username
            if (username.length < 3) {
                showError('username-error', 'Username must be at least 3 characters long.');
                hasErrors = true;
            } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showError('username-error', 'Username can only contain letters, numbers, and underscores.');
                hasErrors = true;
            }

            // Validate password
            if (password.length < 6) {
                showError('password-error', 'Password must be at least 6 characters long.');
                hasErrors = true;
            } else if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                showError('password-error', 'Password must contain both letters and numbers.');
                hasErrors = true;
            }

            // Validate password confirmation
            if (password !== confirmPassword) {
                showError('confirm-password-error', 'Passwords do not match.');
                hasErrors = true;
            }

            if (!hasErrors) {
                performSignup(username, password);
            }
        });

        async function performSignup(username, password) {
            const submitBtn = document.getElementById('signup-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="truncate">Signing up...</span>';

            try {
                // 임시 이메일 생성 (username@ganada.com)
                const email = `${username}@ganada.com`;
                
                // Supabase 회원가입
                const result = await SupabaseClient.Auth.signUp(email, password, {
                    username: username,
                    full_name: username
                });

                if (result.success) {
                    // 회원가입 성공
                    console.log('Signup successful:', result.data);
                    
                    // 사용자 프로필 생성
                    if (result.data.user) {
                        const profileResult = await SupabaseClient.Database.upsertUserProfile(result.data.user.id, {
                            email: email,
                            username: username,
                            full_name: username,
                            avatar_url: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop&crop=face',
                            bio: '',
                            followers_count: 0,
                            following_count: 0,
                            posts_count: 0
                        });

                        if (profileResult.success) {
                            console.log('Profile created:', profileResult.data);
                        }
                    }
                    
                    showSuccessModal();
                } else {
                    // 회원가입 실패
                    showErrorModal(result.error);
                }
            } catch (error) {
                console.error('Signup error:', error);
                showErrorModal('An error occurred during sign up.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span class="truncate">Sign Up</span>';
            }
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function clearErrors() {
            const errorElements = document.querySelectorAll('[id$="-error"]');
            errorElements.forEach(element => {
                element.classList.add('hidden');
                element.textContent = '';
            });
        }

        function showSuccessModal() {
            document.getElementById('success-modal').classList.remove('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
            window.location.href = 'index.html';
        }

        function showErrorModal(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
        }

        function closeErrorModal() {
            document.getElementById('error-modal').classList.add('hidden');
        }



        // Real-time validation
        document.getElementById('username').addEventListener('blur', function() {
            const username = this.value.trim();
            if (username && username.length < 3) {
                showError('username-error', 'Username must be at least 3 characters long.');
            } else if (username && !/^[a-zA-Z0-9_]+$/.test(username)) {
                showError('username-error', 'Username can only contain letters, numbers, and underscores.');
            } else {
                document.getElementById('username-error').classList.add('hidden');
            }
        });

        document.getElementById('password').addEventListener('blur', function() {
            const password = this.value;
            if (password && password.length < 6) {
                showError('password-error', 'Password must be at least 6 characters long.');
            } else if (password && !/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                showError('password-error', 'Password must contain both letters and numbers.');
            } else {
                document.getElementById('password-error').classList.add('hidden');
            }
        });

        document.getElementById('confirm-password').addEventListener('blur', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            if (confirmPassword && password !== confirmPassword) {
                showError('confirm-password-error', 'Passwords do not match.');
            } else {
                document.getElementById('confirm-password-error').classList.add('hidden');
            }
        });
    </script>
</body>
</html> 